\documentclass[10pt,a4]{article}
\usepackage{luacode}

%
% packages
%

\usepackage{fontspec}
\usepackage{mathpazo}
\setmainfont[Ligatures=TeX]{TeXGyrePagella}
\linespread{1.05}

\def\OPTpagesize{210mm,297mm}
\def\OPTtopmargin{1in}
\def\OPTbottommargin{1in}
\def\OPTinnermargin{0.75in}
\def\OPToutermargin{1.0in}
\def\OPTbindingoffset{0.35in}
\usepackage[papersize={\OPTpagesize},
twoside,
includehead,
top=\OPTtopmargin,
bottom=\OPTbottommargin,
inner=\OPTinnermargin,
outer=\OPToutermargin,
bindingoffset=\OPTbindingoffset]{geometry}

\usepackage{xcolor}
\def\OPTlinkcolor{0,0.45,0} % RGB components for clickable links
\definecolor{linkcolor}{rgb}{\OPTlinkcolor}
\usepackage[backref=page,
colorlinks,
citecolor=linkcolor,
linkcolor=linkcolor,
urlcolor=linkcolor,
unicode=true]{hyperref}

\usepackage{amssymb,amsmath,amsthm}
% \usepackage{mathabx}
\usepackage{mathtools}
\usepackage{bussproofs}
\newenvironment{bprooftree}{\leavevmode\hbox\bgroup}{\DisplayProof\egroup}
\usepackage{framed}

\input{macro}
\newcommand{\nuabs}[2]{\nu #1.\,#2}
\newcommand{\conuabs}[2]{\overline{\nu} #1.\,#2}
\newcommand{\tensor}[2]{\mathsf{tensor}(#1, #2)}
\newcommand{\tpar}[2]{\mathsf{dispatch}(#1, #2)}
\newcommand{\tleft}[1]{\mathsf{left}\,#1}
\newcommand{\tright}[1]{\mathsf{right}\,#1}
\newcommand{\tlet}[4]{\mathsf{let}\ \tensor{#1}{#2} = #3\ \mathsf{in}\ #4}
\newcommand{\E}{\mathbb{E}}
\newcommand{\J}{\mathcal{J}}

\usepackage{cmll}

% \newcommand{\inf}[1]{\vdash^{#1}}

\usepackage{tikz}
\usetikzlibrary{cd}

\usepackage{amssymb,amsmath,amsthm,stmaryrd,mathrsfs,wasysym}
\usepackage{enumitem,mathtools,xspace}
\usepackage{xstring}

\title{}
\date{}
\author{}

\begin{document}

% \maketitle

\small
initial system:
\begin{framed}
  \begin{center}
    \begin{bprooftree}
      \AxiomC{\( i \neq \infty \)}
      \RightLabel{\( \ir{(empty)} \)}
      \UnaryInfC{\( \ictx{i}{\cdot} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \ictx{i}{\Gamma} \)}
      \RightLabel{\( \ir{(univ)} \)}
      \UnaryInfC{\( \Gamma \infer{i} \univ_{j} : \univ_{\infty} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \infer{i} A : \univ_{j} \)}
      \RightLabel{\( \ir{(ext)} \)}
      \UnaryInfC{\( \ictx{i}{\Gamma, x : A} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \ictx{i}{\Gamma, x : A} \)}
      \RightLabel{\( \ir{(var)} \)}
      \UnaryInfC{\( \Gamma, x : A \infer{i} x : A \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \ictx{i}{\Gamma} \)}
      \RightLabel{\( (\Eps) \)}
      \UnaryInfC{\( \Gamma \infer{i} \Eps_{k} : \univ_{\infty} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \ictx{i}{\Gamma} \)}
      \AxiomC{\( c \in \Eps_{k} \)}
      \RightLabel{\( (\Eps_{\ir{i}}) \)}
      \BinaryInfC{\( \Gamma \infer{i} c : \Eps_{k} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \infer{i} e : \Eps_{k} \)}
      \AxiomC{\( (\Gamma, x : \Eps_{k} \infer{i} e_{c} : A)_{c \in \Eps_{k}} \)}
      \RightLabel{\( (\Eps_{\ir{e}}) \)}
      \BinaryInfC{\( \Gamma \infer{i} \LET{x}{e}{(c \Rightarrow e_{c})} : A \subst{x}{e} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \infer{i} A_{0} : \univ_{j_{0}} \hspace{2em} \cdots \hspace{2em} \Gamma, x_{0} : A_{0}, \ldots, x_{n-1} : A_{n-1} \infer{i} A_{n} : \univ_{j_{n}} \hspace{2em} j \leq j_{0} \sqcap \cdots \sqcap j_{n} \)}
      \RightLabel{\( (\Pi) \)}
      \UnaryInfC{\( \Gamma \infer{i} \idprod{j}{x_{0} : A_{0}, \ldots, x_{n-1} : A_{n-1}}{A_{n}} : \univ_{j} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma, x_{0} : A_{0}, \ldots, x_{n-1} : A_{n-1} \infer{i} e : A_{n} \)}
      % \AxiomC{\( \Gamma \infer{i} \idprod{j}{x_{0} : A_{0}, \ldots, x_{n-1} : A_{n-1}}{A_{n}} : \univ_{j} \)}
      \RightLabel{\( (\Pi_{\ir{i}}) \)}
      \UnaryInfC{\( \Gamma \infer{i} \iabs{j}{x}{e} : \idprod{j}{x_{0} : A_{0}, \ldots, x_{n-1} : A_{n-1}}{A_{n}} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \infer{i} e : \idprod{j}{x_{0} : A_{0}, \ldots, x_{n-1} : A_{n-1}}{A_{n}} \hspace{2em} \Gamma \infer{i} e_{0} : A_{0} \hspace{2em} \cdots \hspace{2em} \Gamma \infer{i} e_{n-1} : A_{n-1} \subst{x_{k}}{e_{k}} \)}
      \RightLabel{\( (\Pi_{\ir{e}}) \)}
      \UnaryInfC{\( \Gamma \infer{i} \iappE{j}{e}{(e_{0}, \ldots, e_{n-1})} : A_{n} \subst{x_{k}}{e_{k}} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \infer{i} A_{0} : \univ_{j_{0}} \hspace{2em} \cdots \hspace{2em} \Gamma, x_{0} : A_{0}, \ldots, x_{n-1} : A_{n-1} \infer{i} A_{n} : \univ_{j_{n}} \hspace{2em} j \leq j_{0} \sqcap \cdots \sqcap j_{n} \)}
      \RightLabel{\( (\Sigma) \)}
      \UnaryInfC{\( \Gamma \infer{i} \idsum{j}{x_{0} : A_{0}, \ldots, x_{n-1} : A_{n-1}}{A_{n}} : \univ_{j} \)}
    \end{bprooftree}
    \\
    % \begin{bprooftree}
    %   \AxiomC{\( \Gamma \vdash A : \univ_{i} \)}
    %   \AxiomC{\( \Gamma, x : A \vdash B : \univ_{i} \)}
    %   \RightLabel{\( (\Sigma) \)}
    %   \BinaryInfC{\( \Gamma \vdash \dsum{x : A}{B} : \univ_{i} \)}
    % \end{bprooftree}
    % \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \infer{i} e_{0} : A_{0} \)}
      \AxiomC{\( \ldots \)}
      \AxiomC{\( \Gamma \infer{i} e_{n} : A_{n} \subst{x_{k}}{e_{k}} \)}
      \RightLabel{\( (\Sigma_{\ir{i}}) \)}
      \TrinaryInfC{\( \Gamma \infer{i} (e_{1}, \ldots, e_{n})^{j} : \idsum{j}{x_{1} : A_{1}, \ldots, x_{n-1} : A_{n-1}}{A_{n}} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \infer{i} e_{1} : \idsum{j}{x_{1} : A_{1}, \ldots, x_{n-1} : A_{n-1}}{A_{n}} \)}
      \AxiomC{\( \Gamma, x_{0} : A_{0}, \ldots, x_{n} : A_{n} \infer{i} e_{2} : B \subst{z}{(x_{0}, \ldots, x_{n})^{j}} \)}
      \RightLabel{\( (\Sigma_{\ir{e}}) \)}
      \BinaryInfC{\( \Gamma \infer{i} \LET{(x_{0}, \ldots, x_{n})^{j}}{e_{1}}{e_{2}} : B \subst{z}{e_{1}} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \infer{i} A : \univ_{j} \)}
      \RightLabel{\( (\Box) \)}
      \UnaryInfC{\( \Gamma \infer{i} \Box A : \univ_{j} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \infer{i} e : A \)}
      \AxiomC{\( i \leq \floor*{\Gamma} \)}
      \AxiomC{\( \ictx{i-1}{\Delta} \)}
      \RightLabel{\( (\Box_{\ir{i}}) \)}
      \TrinaryInfC{\( \Gamma, \Delta \infer{i-1} \mybox{e} : \Box A \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \infer{i-1} e : \Box A \)}
      \AxiomC{\( i \leq \floor*{\Gamma} \)}
      \AxiomC{\( \ictx{i}{\Delta} \)}
      \RightLabel{\( (\Box_{\ir{e}}) \)}
      \TrinaryInfC{\( \Gamma, \Delta \infer{i} \myunbox{e} : A \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \infer{i} A : \univ_{j} \)}
      \RightLabel{\( (!) \)}
      \UnaryInfC{\( \Gamma \infer{i} \shriek{A} : \univ_{\infty} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \shriek{\Gamma} \infer{i} e : A \)}
      \AxiomC{\( \ictx{i}{\Delta} \)}
      \RightLabel{\( (!_{\ir{i}}) \)}
      \BinaryInfC{\( \shriek{\Gamma}, \Delta \infer{i-1} \mylift{e} : \shriek{A^{-i}} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \shriek{\Gamma} \infer{i-1} e : \shriek{A} \)}
      \AxiomC{\( \ictx{i}{\Delta} \)}
      \RightLabel{\( (!_{\ir{e}}) \)}
      \BinaryInfC{\( \shriek{\Gamma}, \Delta \infer{i} \myunlift{e} : A^{+i} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma, x : A \vdash e : A \)}
      \RightLabel{\( \ir{(fix)} \)}
      \UnaryInfC{\( \Gamma \vdash \fix{x}{e} : A \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \vphantom{\Gamma} \)}
      \RightLabel{\( \ir{(constant)} \)}
      \UnaryInfC{\( \Gamma \vdash c : A_{c} \)}
    \end{bprooftree}
  \end{center}
\end{framed}

\newpage

after closure conversion:
\begin{framed}
  \begin{center}
    \begin{bprooftree}
      \AxiomC{\( \vphantom{\Gamma} \)}
      \RightLabel{\( \ir{(empty)} \)}
      \UnaryInfC{\( \ctx{\emptyset} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \ctx{\Gamma} \)}
      \RightLabel{\( \ir{(univ)} \)}
      \UnaryInfC{\( \Gamma \vdash \univ_{i} : \univ_{i + 1} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash A : \univ_{i} \)}
      \RightLabel{\( \ir{(hier)} \)}
      \UnaryInfC{\( \Gamma \vdash A : \univ_{i + 1} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash A : \univ_{i} \)}
      \RightLabel{\( \ir{(ext)} \)}
      \UnaryInfC{\( \ctx{\Gamma, x : A} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \ctx{\Gamma, x : A} \)}
      \RightLabel{\( \ir{(var)} \)}
      \UnaryInfC{\( \Gamma, x : A \vdash x : A \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash A : \univ_{i} \)}
      \AxiomC{\( \Gamma, x : A \vdash B : \univ_{i} \)}
      \RightLabel{\( (\Pi) \)}
      \BinaryInfC{\( \Gamma \vdash \dprod{x : A}{B} : \univ_{i} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( x_{1} : A_{1}, \ldots, x_{n} : A_{n} \vdash e : B \)}
      \RightLabel{\( (\Pi_{\ir{i}}) \)}
      \UnaryInfC{\( \Gamma \vdash \abs{(x_{1}, \ldots, x_{n})}{e} : \dprod{x_{1} : A_{1}, \ldots, x_{n} : A_{n}}{B} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash e : \dprod{x_{1} : A_{1}, \ldots, x_{n} : A_{n}}{B}\)}
      \AxiomC{\( \Gamma \vdash e_{1} : A_{1} \hspace{1em} \ldots \hspace{1em} \Gamma \vdash e_{n} : A_{n} \)}
      \RightLabel{\( (\Pi_{\ir{e}}) \)}
      \BinaryInfC{\( \Gamma \vdash \appE{e}{(e_{1}, \ldots, e_{n})} : B \subst{x_{i}}{e_{i}} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash A : \univ_{i} \)}
      \AxiomC{\( \Gamma, x : A \vdash B : \univ_{i} \)}
      \RightLabel{\( (\Sigma) \)}
      \BinaryInfC{\( \Gamma \vdash \dsum{x : A}{B} : \univ_{i} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash e_{1} : A_{1} \)}
      \AxiomC{\( \ldots \)}
      \AxiomC{\( \Gamma \vdash e_{n} : A_{n} \subst{x_{1}}{e_{1}}\ldots\subst{x_{n-1}}{e_{n-1}} \)}
      \RightLabel{\( (\Sigma_{\ir{i}}) \)}
      \TrinaryInfC{\( \Gamma \vdash (e_{1}, \ldots, e_{n}) : \dsum{x_{1} : A_{1}, \ldots, x_{n-1} : A_{n-1}}{A_{n}} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash e_{1} : \dsum{x_{1} : A_{1}, \ldots, x_{n-1} : A_{n-1}}{A_{n}} \)}
      \AxiomC{\( \Gamma, x_{1} : A_{1}, \ldots, x_{n} : A_{n} \vdash e_{2} : B \subst{z}{(x_{1}, \ldots, x_{n})} \)}
      \RightLabel{\( (\Sigma_{\ir{e}}) \)}
      \BinaryInfC{\( \Gamma \vdash \LET{(x_{1}, \ldots, x_{n})}{e_{1}}{e_{2}} : B \subst{z}{e_{1}} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( x : A \vdash e : A \)}
      \RightLabel{\( \ir{(rec)} \)}
      \UnaryInfC{\( \Gamma \vdash \rec{x}{e} : A \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \vphantom{\Gamma} \)}
      \RightLabel{\( \ir{(constant)} \)}
      \UnaryInfC{\( \Gamma \vdash c : A_{c} \)}
    \end{bprooftree}
  \end{center}
\end{framed}

\newpage

polarize:
\begin{framed}
  \begin{center}
    \begin{bprooftree}
      \AxiomC{\( \vphantom{\Gamma} \)}
      \RightLabel{\( \ir{(empty)} \)}
      \UnaryInfC{\( \ctx{\emptyset} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \ctx{\Gamma} \)}
      \RightLabel{\( \ir{(univ)} \)}
      \UnaryInfC{\( \Gamma \vdash \univ_{i} : \univ_{i + 1} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash A : \univ_{i} \)}
      \RightLabel{\( \ir{(hier)} \)}
      \UnaryInfC{\( \Gamma \vdash A : \univ_{i + 1} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash P : \univ_{i} \)}
      \RightLabel{\( \ir{(ext)} \)}
      \UnaryInfC{\( \ctx{\Gamma, x : P} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \ctx{\Gamma, x : P} \)}
      \RightLabel{\( \ir{(var)} \)}
      \UnaryInfC{\( \Gamma, x : P \vdash x : P \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash P : \univ_{i} \)}
      \AxiomC{\( \Gamma, x : P \vdash N : \univ_{i} \)}
      \RightLabel{\( (\Pi) \)}
      \BinaryInfC{\( \Gamma \vdash \dprod{x : P}{N} : \univ_{i} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma, x : P \vdash e : N \)}
      \RightLabel{\( (\Pi_{\ir{i}}) \)}
      \UnaryInfC{\( \Gamma \vdash \abs{x}{e} : \dprod{x : P}{N} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash e_{1} : \dprod{x : P}{N} \)}
      \AxiomC{\( \Gamma \vdash e_{2} : P \)}
      \RightLabel{\( (\Pi_{\ir{e}}) \)}
      \BinaryInfC{\( \Gamma \vdash \appE{e_{1}}{e_{2}} : N \subst{x}{e_{1}} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash P : \univ_{i} \)}
      \AxiomC{\( \Gamma, x : P \vdash Q : \univ_{i} \)}
      \RightLabel{\( (\Sigma) \)}
      \BinaryInfC{\( \Gamma \vdash \dsum{x : P}{Q} : \univ_{i} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash e_{1} : P_{1} \)}
      \AxiomC{\( \ldots \)}
      \AxiomC{\( \Gamma \vdash e_{n} : P_{n} \subst{x_{1}}{e_{1}}\ldots\subst{x_{n-1}}{e_{n-1}} \)}
      \RightLabel{\( (\Sigma_{\ir{i}}) \)}
      \TrinaryInfC{\( \Gamma \vdash (e_{1}, \ldots, e_{n}) : \dsum{x_{1} : P_{1}, \ldots, x_{n-1} : P_{n-1}}{P_{n}} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash e_{1} : \dsum{x_{1} : P_{1}, \ldots, x_{n-1} : P_{n-1}}{P_{n}} \)}
      \AxiomC{\( \Gamma, x_{1} : P_{1}, \ldots, x_{n} : P_{n} \vdash e_{2} : N \subst{z}{(x_{1}, \ldots, x_{n})} \)}
      \RightLabel{\( (\Sigma_{\ir{e}}) \)}
      \BinaryInfC{\( \Gamma \vdash \LET{(x_{1}, \ldots, x_{n})}{e_{1}}{e_{2}} : N \subst{z}{e_{1}} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash P : \univ_{i} \)}
      \RightLabel{\( (\uparrow) \)}
      \UnaryInfC{\( \Gamma \vdash \upT{P} : \univ_{i} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash e : P \)}
      \RightLabel{\( (\uparrow_{\ir{i}}) \)}
      \UnaryInfC{\( \Gamma \vdash \vret{e} : \upT{P} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash e_{1} : \upT{P} \)}
      \AxiomC{\( \Gamma, x : P \vdash e_{2} : N  \)}
      \RightLabel{\( (\uparrow_{\ir{e}}) \)}
      \BinaryInfC{\( \Gamma \vdash \bind{e_{1}}{x}{e_{2}} : N \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash N : \univ_{i} \)}
      \RightLabel{\( (\downarrow) \)}
      \UnaryInfC{\( \Gamma \vdash \downT{N} : \univ_{i} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash e : N \)}
      \RightLabel{\( (\downarrow_{\ir{i}}) \)}
      \UnaryInfC{\( \Gamma \vdash \thunkS{e} : \downT{N} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash e : \downT{N} \)}
      \RightLabel{\( (\downarrow_{\ir{e}}) \)}
      \UnaryInfC{\( \Gamma \vdash \forceS{e} : N \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma, x : \downT{N} \vdash e : N \)}
      \RightLabel{\( \ir{(rec)} \)}
      \UnaryInfC{\( \Gamma \vdash \rec{x}{e} : N \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \vphantom{\Gamma} \)}
      \RightLabel{\( \ir{(constant)} \)}
      \UnaryInfC{\( \Gamma \vdash c : P_{c} \)}
    \end{bprooftree}
  \end{center}
\end{framed}

\newpage

after closure conversion:
\begin{framed}
  \begin{center}
    \begin{bprooftree}
      \AxiomC{\( \vphantom{\Gamma} \)}
      \RightLabel{\( \ir{(empty)} \)}
      \UnaryInfC{\( \ctx{\emptyset} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \ctx{\Gamma} \)}
      \RightLabel{\( \ir{(univ)} \)}
      \UnaryInfC{\( \Gamma \vdash \univ_{i} : \univ_{i + 1} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash A : \univ_{i} \)}
      \RightLabel{\( \ir{(hier)} \)}
      \UnaryInfC{\( \Gamma \vdash A : \univ_{i + 1} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash P : \univ_{i} \)}
      \RightLabel{\( \ir{(ext)} \)}
      \UnaryInfC{\( \ctx{\Gamma, x : P} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \ctx{\Gamma, x : P} \)}
      \RightLabel{\( \ir{(var)} \)}
      \UnaryInfC{\( \Gamma, x : P \vdash x : P \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash P : \univ_{i} \)}
      \AxiomC{\( \Gamma, x : P \vdash N : \univ_{i} \)}
      \RightLabel{\( (\Pi) \)}
      \BinaryInfC{\( \Gamma \vdash \dprod{x : P}{N} : \univ_{i} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( x_{1} : P_{1}, \ldots, x_{n} : P_{n} \vdash e : N \)}
      \RightLabel{\( (\Pi_{\ir{i}}) \)}
      \UnaryInfC{\( \Gamma \vdash \xabs{(x_{1}, \ldots, x_{n})}{e} : \downT{\dprod{x_{1} : P_{1}, \ldots, x_{n} : P_{n}}{N}} \)}

    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash e : \downT{\dprod{x_{1} : P_{1}, \ldots, x_{n} : P_{n}}{N}} \)}
      \AxiomC{\( \Gamma \vdash e_{1} : P_{1} \hspace{1em} \ldots \hspace{1em} \Gamma \vdash e_{n} : P_{n} \)}
      \RightLabel{\( (\Pi_{\ir{e}}) \)}
      \BinaryInfC{\( \Gamma \vdash \appE{(\forceS{e_{1}})}{(e_{1}, \ldots, e_{n})} : N \subst{x_{i}}{e_{i}} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash P : \univ_{i} \)}
      \AxiomC{\( \Gamma, x : P \vdash Q : \univ_{i} \)}
      \RightLabel{\( (\Sigma) \)}
      \BinaryInfC{\( \Gamma \vdash \dsum{x : P}{Q} : \univ_{i} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash e_{1} : P_{1} \)}
      \AxiomC{\( \ldots \)}
      \AxiomC{\( \Gamma \vdash e_{n} : P_{n} \subst{x_{1}}{e_{1}}\ldots\subst{x_{n-1}}{e_{n-1}} \)}
      \RightLabel{\( (\Sigma_{\ir{i}}) \)}
      \TrinaryInfC{\( \Gamma \vdash \vret{(e_{1}, \ldots, e_{n})} : \dsum{x_{1} : P_{1}, \ldots, x_{n-1} : P_{n-1}}{P_{n}} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash e : \dsum{x_{1} : P_{1}, \ldots, x_{n-1} : P_{n-1}}{P_{n}} \)}
      \AxiomC{\( \Gamma, x_{1} : P_{1}, \ldots, x_{n} : P_{n} \vdash e' : N \subst{z}{(x_{1}, \ldots, x_{n})} \)}
      \RightLabel{\( (\Sigma_{\ir{e}}) \)}
      \BinaryInfC{\( \Gamma \vdash \LET{(x_{1}, \ldots, x_{n})}{e}{e'} : N \subst{z}{e} \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash P : \univ_{i} \)}
      \RightLabel{\( (\uparrow) \)}
      \UnaryInfC{\( \Gamma \vdash \upT{P} : \univ_{i} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash e : P \)}
      \RightLabel{\( (\uparrow_{\ir{i}}) \)}
      \UnaryInfC{\( \Gamma \vdash \vret{e} : \upT{P} \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \Gamma \vdash e_{1} : \upT{P} \)}
      \AxiomC{\( \Gamma, x : P \vdash e_{2} : N  \)}
      \RightLabel{\( (\uparrow_{\ir{e}}) \)}
      \BinaryInfC{\( \Gamma \vdash \bind{e_{1}}{x}{e_{2}} : N \)}
    \end{bprooftree}
    \\
    \vspace{1.5em}
    \begin{bprooftree}
      \AxiomC{\( x : \downT{N} \vdash e : N \)}
      \RightLabel{\( \ir{(rec)} \)}
      \UnaryInfC{\( \Gamma \vdash \rec{x}{e} : N \)}
    \end{bprooftree}
    \begin{bprooftree}
      \AxiomC{\( \vphantom{\Gamma} \)}
      \RightLabel{\( \ir{(constant)} \)}
      \UnaryInfC{\( \Gamma \vdash c : \downT{N_{c}} \)}
    \end{bprooftree}
  \end{center}
\end{framed}

\normalsize

\bibliographystyle{plain}
\bibliography{library}

\end{document}
