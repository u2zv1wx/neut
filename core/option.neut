(no-implicit-core)

(include "core/foundation.neut")

(include "core/functor.neut")

(include "core/monad.neut")

(section option)

(inductive option ((a tau))
  (none ()
    (option a))
  (some ((x a))
    (option a)))

(define map
  (witness (functor-form option)
    (lambda (a b f m)
      (option.fold a m
        (lambda (_)
          (option b))
        (lambda ()
          (none b))
        (lambda (x)
          (some b (f x)))))))

(define return
  (witness (return-type option)
    (lambda (a x)
      (some a x))))

(define bind
  (witness (bind-type option)
    (lambda (a b m k)
      (option.fold a m
        (lambda (_)
          (option b))
        (lambda ()
          (none b))
        (lambda (x)
          (k x))))))

(define from-option
  ((a tau)
   (x a)
   (m (option a)))
  (witness a
    (option.fold a m
      (lambda (_)
        a)
      (lambda ()
        x)
      (lambda (y)
        y))))

;; (attribute from-option (implicit 0))

(define witness-functor
  (witness (functor option)
    (functor.new
      option
      option.map)))

?functor.map

(define witness-monad
  (witness (monad option)
    (monad.new
      option
      option.witness-functor
      option.return
      option.bind)))

(end option)
